---
status: planned
depends_on: []
files_modified:
  - .claude/skills/session-resumption/SKILL.md
  - .claude/commands/resume.md
---

# Task 2: Create Session Resumption Skill (Replaces Hook)

## Description

**CHANGED FROM HOOK TO SKILL** - Analysis revealed that Claude Code hooks framework doesn't support session-start events. Instead, we create a skill + command that the orchestrator (or user) can invoke at session start.

This skill detects incomplete work from STATE.md and provides structured resumption flow.

## Why Skill Instead of Hook

1. âŒ Hooks are NOT a Claude Code framework feature
2. âŒ Bash scripts don't work reliably on Windows
3. âŒ No session lifecycle events to hook into
4. âœ… Skills work cross-platform
5. âœ… Orchestrator can invoke skill at start
6. âœ… User can invoke via `/resume` command

## What to do

### 1. Create `.claude/skills/session-resumption/SKILL.md`:

```markdown
---
name: session-resumption
version: 1.0.0
description: Detects incomplete work and provides resumption flow
triggers:
  - Session start
  - Orchestrator first action
  - User command /resume
---

# Session Resumption Skill

## Purpose

Check work/STATE.md for incomplete work and provide structured resumption options.

## Algorithm

```
1. Check if work/STATE.md exists
   IF NOT: Report "Starting fresh - no previous state"
   RETURN

2. Parse STATE.md sections:
   - "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°" â†’ extract task, phase, status
   - "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸" â†’ extract next steps list
   - "Ğ‘Ğ»Ğ¾ĞºĞµÑ€Ñ‹" â†’ extract active blockers
   - "Session Notes" â†’ find last session date

3. IF status contains "completed" or "done":
   Report "Previous work completed"
   RETURN

4. IF incomplete work found:
   Display resumption summary:

   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“‹ INCOMPLETE WORK DETECTED
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Task: [task name]
   Phase: [phase]
   Status: [status]
   Last Session: [date]

   Next Steps:
   1. [step 1]
   2. [step 2]

   Blockers: [blockers or "None"]

   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5. Ask user:
   "Resume from where we left off? [Y/n]"

6. IF resume:
   - Load relevant skills for current phase
   - Continue with first next step

   IF start fresh:
   - Archive current STATE.md to work/archive/
   - Create new STATE.md
```

## Integration with Orchestrator

Orchestrator MUST invoke this skill as FIRST action:

```
Orchestrator receives user request
    â†“
FIRST: Invoke session-resumption skill
    â†“
IF incomplete work:
    - Ask user: resume or start fresh?
    - IF resume: continue previous work
    - IF fresh: proceed with new request
    â†“
THEN: Classify new request intent
```

## Manual Invocation

User can invoke via `/resume` command at any time.

## Output Format

Skill produces structured output:

```json
{
  "hasIncompleteWork": true,
  "previousTask": "Add user authentication",
  "phase": "implementation",
  "status": "tasks 1-3 complete, task 4 in progress",
  "lastSession": "2026-01-18",
  "nextSteps": [
    "Complete task 4: API endpoints",
    "Run tests",
    "UAT"
  ],
  "blockers": [],
  "recommendation": "resume"
}
```

## STATE.md Parsing

Expected STATE.md structure:

```markdown
## Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°
- Feature: [feature name]
- Phase: [planning|development|testing|review|complete]
- Task: [current task]
- Status: [status description]

## Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸
1. [step 1]
2. [step 2]

## Ğ‘Ğ»Ğ¾ĞºĞµÑ€Ñ‹
| Blocker | Impact | Status |
|---------|--------|--------|
| ...     | ...    | ...    |
```

## Error Handling

- STATE.md doesn't exist â†’ "Starting fresh"
- STATE.md malformed â†’ Try to parse what's possible, warn about issues
- No "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°" section â†’ "No tracked work found"
- Multiple features in progress â†’ List all, ask which to resume
```

### 2. Create `.claude/commands/resume.md`:

```markdown
---
allowed-tools:
  - Read
  - AskUserQuestion
---

# /resume Command

Invoke the session-resumption skill to check for and resume incomplete work.

## Usage

```
/resume
```

## What it does

1. Reads work/STATE.md
2. Checks for incomplete work
3. Displays summary if found
4. Asks whether to resume or start fresh
5. Loads appropriate skills if resuming
```

## Acceptance Criteria

- [ ] Skill file exists at .claude/skills/session-resumption/SKILL.md
- [ ] Command file exists at .claude/commands/resume.md
- [ ] Correctly parses STATE.md Russian sections
- [ ] Displays resumption summary with all key info
- [ ] Asks user for confirmation (resume vs fresh)
- [ ] Produces structured JSON output
- [ ] Documents integration with orchestrator
- [ ] Handles missing/malformed STATE.md gracefully

## Context Files

**Required:**
- `work/STATE.md` (target file to parse)
- `.claude/shared/templates/new-project/work/STATE.md` (template structure)
- `.claude/skills/methodology/SKILL.md` (skill pattern reference)

## Technical Details

**Files:**
- `.claude/skills/session-resumption/SKILL.md` - Create new
- `.claude/commands/resume.md` - Create new

**No bash dependencies** - pure skill/command approach
**Cross-platform** - works on Windows, Mac, Linux

**Edge cases:**
- STATE.md doesn't exist â†’ graceful "starting fresh" message
- STATE.md exists but empty â†’ treat as "no previous work"
- Multiple features in progress â†’ list all, user chooses
- Blockers active â†’ highlight prominently, may need resolution first
