---
status: planned
depends_on: []
files_modified:
  - .claude/skills/context-monitor/SKILL.md
---

# Task 3: Create Context Monitor Skill

## Description

Create a skill that monitors context window usage and enforces limits to prevent quality degradation.

## What to do

1. Create directory: `.claude/skills/context-monitor/`

2. Create `.claude/skills/context-monitor/SKILL.md` with:
   - Frontmatter (name, version, description)
   - Context estimation algorithm
   - Trigger points (phase changes, every 10 tool calls)
   - Warning and blocking thresholds
   - Subagent dispatch recommendations

3. Estimation algorithm (heuristics-based):
```
Context Usage Estimation:

Files loaded:
- Small file (<100 lines): ~2%
- Medium file (100-500 lines): ~5%
- Large file (>500 lines): ~10%

Conversation:
- Each user message: ~1%
- Each assistant response: ~2-5%
- Tool calls with output: ~2-3% each

Thresholds:
- 0-30%: Peak quality ‚úÖ
- 30-50%: Good quality ‚ö†Ô∏è
- 50-70%: Degradation begins üî∂
- 70%+: Low quality, BLOCK üõë
```

4. Actions at each threshold:
   - **50%**: Display warning, suggest completing current task
   - **70%**: BLOCK new tasks, require one of:
     - Dispatch subagent for remaining work
     - Clear context (new session)
     - User explicit override

## Acceptance Criteria

- [ ] Skill directory exists at .claude/skills/context-monitor/
- [ ] SKILL.md file exists with valid YAML frontmatter
- [ ] Estimation algorithm clearly documented
- [ ] Warning message template at 50%
- [ ] BLOCK message template at 70%
- [ ] Subagent dispatch instructions included
- [ ] Override mechanism documented

## Context Files

**Required:**
- `.claude/skills/using-superpowers/SKILL.md` (skill pattern reference)
- `.claude/skills/verification-before-completion/SKILL.md` (another skill pattern)
- `CLAUDE.md` (existing context rules to reference)

## Technical Details

**Files:**
- `.claude/skills/context-monitor/SKILL.md` - Create new file

**Message templates:**

Warning (50%):
```
‚ö†Ô∏è CONTEXT MONITOR: ~50% capacity reached

Current session has loaded significant context.
Quality may begin degrading.

Recommendations:
1. Complete current task before starting new ones
2. Avoid loading additional large files
3. Consider using subagent for complex subtasks

Continue with current work? [y/N]
```

Block (70%):
```
üõë CONTEXT MONITOR: ~70% capacity - BLOCKING NEW TASKS

Context window near capacity. Quality will degrade.

Required actions (choose one):
1. Dispatch subagent for remaining work
   ‚Üí Use Task tool with fresh context
2. Start new session
   ‚Üí Update STATE.md, begin fresh
3. Override (not recommended)
   ‚Üí Type "override context block" to continue

Current work will be preserved in STATE.md.
```

**Edge cases:**
- Cannot accurately estimate ‚Üí use conservative values (assume higher)
- User wants to proceed despite warning ‚Üí allow with acknowledgment
- Subagent not available ‚Üí suggest new session
- Multiple large files loaded at once ‚Üí immediate warning

**Integration:**
- Referenced by orchestrator for pre-execution checks
- Mentioned in CLAUDE.md context management section
