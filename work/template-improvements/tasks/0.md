---
status: planned
depends_on: []
files_modified:
  - .claude/skills/methodology/guides/skill-composition.md
  - .claude/skills/SKILLS_INDEX.md
---

# Task 0: Create Skill Composition Guide

## Description

Before creating orchestrator, we need to document how skills compose together — their inputs, outputs, prerequisites, and contracts. This prevents orchestrator from calling skills in wrong order or missing required artifacts.

## Why This Is Critical

Analysis revealed:
- Skills reference each other loosely ("after this, use Skill B")
- No documented contracts (what artifacts Skill A produces for Skill B)
- `code-developer` references "context files" without defining them
- `user-acceptance-testing` expects `user-spec.md` but doesn't say where

Without composition guide, orchestrator will:
- Call skills in wrong order
- Miss required artifacts
- Produce incomplete work

## What to do

1. Create `.claude/skills/methodology/guides/skill-composition.md`:

```markdown
# Skill Composition Guide

## Purpose

This guide documents how skills interact with each other — their prerequisites, outputs, and contracts. Use this when building orchestration or selecting skill sequences.

## Skill Contracts

### Planning Phase

| Skill | Requires | Produces | Next Skill |
|-------|----------|----------|------------|
| **context-capture** | Fuzzy requirements | Structured understanding | user-spec-planning |
| **user-spec-planning** | (optional) project.md | `work/<feature>/user-spec.md` | tech-spec-planning |
| **tech-spec-planning** | user-spec.md, project-knowledge guides | `tech-spec.md` + `tasks/*.md` | executing-plans OR subagent-driven |
| **project-planning** | Project idea | `project.md`, `features.md`, `roadmap.md` | /init-context |

### Execution Phase

| Skill | Requires | Produces | Next Skill |
|-------|----------|----------|------------|
| **executing-plans** | tech-spec.md + tasks/*.md | Implemented code + tests | user-acceptance-testing |
| **subagent-driven-development** | tech-spec.md + tasks/*.md | Implemented code + tests | user-acceptance-testing |
| **code-developer** (agent) | task.md + context files | Modified files + test results (JSON) | code-reviewer |
| **code-reviewer** (agent) | Implementation files | Review assessment (JSON) | (fix issues OR proceed) |

### Quality Phase

| Skill | Requires | Produces | Next Skill |
|-------|----------|----------|------------|
| **systematic-debugging** | Bug/error description | Root cause analysis | test-driven-development |
| **test-driven-development** | Clear requirement | Failing test → passing code | verification-before-completion |
| **user-acceptance-testing** | user-spec.md + working code | UAT checklist + user confirmation | verification-before-completion |
| **verification-before-completion** | All code changes complete | Verification proof (command output) | finishing-a-development-branch |
| **finishing-a-development-branch** | Tests pass, verification done | Merge/PR/cleanup decision | (done) |

## Required Artifacts

### For Planning Skills

```
user-spec-planning requires:
  - (optional) .claude/skills/project-knowledge/guides/project.md
  - User's feature/bug description

  produces:
  - work/<feature>/user-spec.md
  - Interview trail in .claude/tmp/ (for recovery)
```

```
tech-spec-planning requires:
  - work/<feature>/user-spec.md (MANDATORY)
  - .claude/skills/project-knowledge/guides/architecture.md
  - .claude/skills/project-knowledge/guides/patterns.md
  - .claude/skills/project-knowledge/guides/database.md (if data involved)

  produces:
  - work/<feature>/tech-spec.md
  - work/<feature>/tasks/*.md (with depends_on, files_modified)
```

### For Execution Skills

```
code-developer (agent) requires:
  - task.md file path
  - Context files listed in task.md:
    - .claude/skills/project-knowledge/guides/architecture.md
    - .claude/skills/project-knowledge/guides/patterns.md
    - work/<feature>/user-spec.md
    - work/<feature>/tech-spec.md

  produces (JSON):
  {
    "status": "completed|failed",
    "filesModified": ["path/to/file.ts"],
    "testResults": { "passed": true, "output": "..." },
    "acceptanceCriteria": { "criterion1": true }
  }
```

```
subagent-driven-development requires:
  - tech-spec.md with Implementation Tasks list
  - tasks/*.md with depends_on and files_modified fields

  produces:
  - All tasks completed
  - Code review passed for each wave
  - Background tasks tracked in work/background-tasks.json
```

### For Quality Skills

```
user-acceptance-testing requires:
  - work/<feature>/user-spec.md (for test scenarios)
  - Working code (all tasks implemented)

  produces:
  - UAT checklist presented to user
  - User confirmation: "UAT passed" or list of issues
```

```
verification-before-completion requires:
  - Implementation complete
  - UAT passed

  produces:
  - Fresh command output (tests, build, lint)
  - Verification proof in transcript
```

## Skill Chains

### New Feature (Full Chain)
```
context-capture (if fuzzy)
    ↓
user-spec-planning
    ↓
tech-spec-planning
    ↓
subagent-driven-development
    ↓
user-acceptance-testing (BLOCKING)
    ↓
verification-before-completion (BLOCKING)
    ↓
finishing-a-development-branch
    ↓
(commit)
```

### Bug Fix Chain
```
systematic-debugging (Phase 1-3)
    ↓
test-driven-development (create failing test)
    ↓
(implement fix)
    ↓
verification-before-completion
    ↓
(commit)
```

### Quick Task Chain
```
(no planning needed)
    ↓
test-driven-development
    ↓
verification-before-completion
    ↓
(commit)
```

## Error Recovery

### Missing Artifact
If skill reports missing artifact:
1. Check if previous skill completed successfully
2. If not: run previous skill first
3. If yes: check artifact path (might be in different location)

### Skill Fails
If skill fails mid-execution:
1. Check STATE.md for last checkpoint
2. Resume from checkpoint (not from beginning)
3. If repeated failures: escalate to manual mode

## Context Files Standard Locations

| Artifact | Location |
|----------|----------|
| Project overview | `.claude/skills/project-knowledge/guides/project.md` |
| Architecture | `.claude/skills/project-knowledge/guides/architecture.md` |
| Code patterns | `.claude/skills/project-knowledge/guides/patterns.md` |
| Database schema | `.claude/skills/project-knowledge/guides/database.md` |
| Deployment info | `.claude/skills/project-knowledge/guides/deployment.md` |
| User spec | `work/<feature>/user-spec.md` |
| Tech spec | `work/<feature>/tech-spec.md` |
| Tasks | `work/<feature>/tasks/*.md` |
| State | `work/STATE.md` (global) |
| Feature state | `work/<feature>/state.json` (per-feature) |
```

2. Update `.claude/skills/SKILLS_INDEX.md`:
   - Add reference to skill-composition.md in header
   - Add note: "See skill-composition.md for input/output contracts"

## Acceptance Criteria

- [ ] skill-composition.md created with all skill contracts
- [ ] Required artifacts documented for each skill
- [ ] Skill chains documented (feature, bug fix, quick task)
- [ ] Error recovery patterns included
- [ ] Context files standard locations listed
- [ ] SKILLS_INDEX.md references the guide

## Context Files

**Required:**
- `.claude/skills/SKILLS_INDEX.md` (to understand skill ecosystem)
- `.claude/skills/user-spec-planning/SKILL.md` (to verify artifacts)
- `.claude/skills/tech-spec-planning/SKILL.md` (to verify artifacts)
- `.claude/skills/subagent-driven-development/SKILL.md` (to verify artifacts)
- `.claude/agents/code-developer.md` (to verify context files)

## Technical Details

**Files:**
- `.claude/skills/methodology/guides/skill-composition.md` - Create new
- `.claude/skills/SKILLS_INDEX.md` - Add reference

**Edge cases:**
- Skill not documented → add to guide with TODO
- Artifact location varies → document all known locations
- New skill added → update guide accordingly
