---
status: planned
depends_on: []
files_modified:
  - work/background-tasks.json
  - .claude/skills/subagent-driven-development/SKILL.md
---

# Task 4: Create Background Tasks Tracking

## Description

Create a JSON schema for tracking background subagent tasks and update subagent-driven-development skill to use it.

## What to do

1. Create `work/background-tasks.json` template:
```json
{
  "version": "1.0",
  "description": "Tracks parallel subagent task execution",
  "tasks": [],
  "activeWave": null,
  "lastUpdated": null
}
```

2. Define task schema:
```json
{
  "id": "task-001-1705680000",
  "taskFile": "work/feature/tasks/1.md",
  "taskTitle": "Create user model",
  "agent": "code-developer",
  "wave": 1,
  "status": "pending|running|completed|failed",
  "startedAt": "2026-01-19T10:00:00Z",
  "completedAt": null,
  "duration": null,
  "result": {
    "filesModified": [],
    "testsRun": false,
    "testsPassed": null
  },
  "error": null
}
```

3. Update `.claude/skills/subagent-driven-development/SKILL.md`:
   - Add section "## Background Task Tracking"
   - Instructions for updating JSON when dispatching
   - Instructions for updating JSON when complete
   - Reading JSON to check wave status

4. Update workflow in skill:
```
Before dispatching subagent:
1. Read work/background-tasks.json
2. Create task entry with status: "pending"
3. Write updated JSON
4. Dispatch subagent
5. Update status to "running"

After subagent completes:
1. Read work/background-tasks.json
2. Update task status to "completed" or "failed"
3. Fill result or error fields
4. Update completedAt timestamp
5. Check if wave complete
6. Write updated JSON
```

## Acceptance Criteria

- [ ] background-tasks.json template exists in work/
- [ ] Schema documented with all fields explained
- [ ] subagent-driven-development skill updated with tracking section
- [ ] JSON update workflow documented step-by-step
- [ ] Status tracking covers all states (pending/running/completed/failed)
- [ ] Wave tracking for parallel execution
- [ ] Example JSON with sample data included

## Context Files

**Required:**
- `.claude/skills/subagent-driven-development/SKILL.md` (file to update)
- `work/STATE.md` (similar tracking pattern reference)
- `.claude/shared/work-templates/` (template patterns)

## Technical Details

**Files:**
- `work/background-tasks.json` - Create new file
- `.claude/skills/subagent-driven-development/SKILL.md` - Update existing

**JSON operations:**
```javascript
// Reading
const tasks = JSON.parse(fs.readFileSync('work/background-tasks.json'));

// Adding task
tasks.tasks.push({
  id: `task-${taskNum}-${Date.now()}`,
  taskFile: taskPath,
  status: 'pending',
  // ...
});
tasks.lastUpdated = new Date().toISOString();

// Updating status
const task = tasks.tasks.find(t => t.id === taskId);
task.status = 'completed';
task.completedAt = new Date().toISOString();

// Writing
fs.writeFileSync('work/background-tasks.json', JSON.stringify(tasks, null, 2));
```

**Edge cases:**
- JSON file doesn't exist → create with empty template
- JSON file corrupted → backup and recreate
- Multiple subagents updating simultaneously → use atomic writes (write to temp, rename)
- Task already exists with same ID → append timestamp to make unique
