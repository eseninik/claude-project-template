---
status: planned
depends_on: []
files_modified:
  - .claude/skills/self-completion/SKILL.md
---

# Task 7: Create Self-Completion Skill

## Description

Create a skill that detects incomplete TodoWrite items and auto-continues until a completion marker.

## What to do

1. Create directory: `.claude/skills/self-completion/`

2. Create `.claude/skills/self-completion/SKILL.md`:

```markdown
---
name: self-completion
version: 1.0.0
description: Auto-continues incomplete work until <done> marker
triggers:
  - TodoWrite shows pending items
  - Session has incomplete work
---

# Self-Completion Skill

## Purpose

Automatically continue working on incomplete todos without requiring user prompts between each item. Tracks iterations to prevent infinite loops.

## Algorithm

```
START:
  iteration_count = 0
  max_iterations = 5

LOOP:
  1. Check TodoWrite for items with status != completed

  2. IF no pending items:
     OUTPUT: "<done>"
     RETURN success

  3. IF iteration_count >= max_iterations:
     OUTPUT: "ðŸ›‘ Max iterations (5) reached"
     OUTPUT: "Remaining items: [list]"
     OUTPUT: "Manual intervention required"
     RETURN max_iterations_reached

  4. Get next pending item
     Mark as in_progress

  5. Execute item:
     - Follow task instructions
     - Run verification if specified
     - Handle errors (trigger recovery hooks)

  6. IF item completed successfully:
     Mark as completed
     iteration_count++
     GOTO LOOP

  7. IF item failed:
     Mark as failed
     OUTPUT: "Task failed: [reason]"
     Ask user: continue with next? or stop?
```

## Usage

### Automatic Activation

Self-completion activates when:
1. Executing multiple tasks via subagent-driven-development
2. Autowork mode pipeline
3. Explicit invocation: "continue until done"

### Manual Invocation

```
User: "Continue working on remaining tasks"
â†’ Activates self-completion
â†’ Works through todos until <done>
```

## Integration

### With subagent-driven-development

Each subagent uses self-completion internally:
```
Subagent receives task
â†’ Breaks into TodoWrite items
â†’ Self-completion processes items
â†’ Returns <done> when complete
â†’ Main agent receives completion signal
```

### With autowork

Autowork pipeline uses self-completion for:
- Spec generation steps
- Task execution steps
- UAT verification steps

## Iteration Tracking

Persisted in memory during execution:
- iteration_count: Current iteration number
- max_iterations: 5 (hardcoded limit)
- items_completed: List of completed item IDs
- current_item: Currently processing item

## Completion Markers

- `<done>` - All items completed successfully
- `<blocked>` - Cannot proceed, needs user input
- `<max_iterations>` - Hit limit, manual review needed
- `<error>` - Unrecoverable error occurred

## Error Handling

1. **Recoverable errors**: Trigger recovery hooks, retry
2. **Unrecoverable errors**: Mark item failed, ask user
3. **Stuck detection**: If same item fails 3 times â†’ blocked

## Examples

### Successful completion
```
[1/3] Creating user model... âœ…
[2/3] Writing tests... âœ…
[3/3] Running verification... âœ…
<done>
```

### Max iterations reached
```
[1/5] Task A... âœ…
[2/5] Task B... âœ…
[3/5] Task C... âœ…
[4/5] Task D... âœ…
[5/5] Task E... âœ…

ðŸ›‘ Max iterations (5) reached
Remaining items:
- Task F (pending)
- Task G (pending)

Manual intervention required.
<max_iterations>
```
```

## Acceptance Criteria

- [ ] Skill directory exists at .claude/skills/self-completion/
- [ ] SKILL.md file exists with valid YAML frontmatter
- [ ] Algorithm documented with clear steps
- [ ] Iteration tracking explained (max 5)
- [ ] Completion markers defined (<done>, <blocked>, etc.)
- [ ] Integration with subagent-driven-development described
- [ ] Error handling documented
- [ ] Examples provided for each scenario

## Context Files

**Required:**
- `.claude/skills/subagent-driven-development/SKILL.md` (integration point)
- `.claude/skills/verification-before-completion/SKILL.md` (similar completion pattern)
- `.claude/skills/executing-plans/SKILL.md` (another execution pattern)

## Technical Details

**Files:**
- `.claude/skills/self-completion/SKILL.md` - Create new

**Edge cases:**
- Todo item impossible to complete â†’ mark as blocked, continue
- External blocker (needs user input) â†’ pause and ask
- Circular dependency between items â†’ detect and report
- Very long running item â†’ check context usage
